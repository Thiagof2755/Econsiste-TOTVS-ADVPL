-- QUERY PRINCIPAL JA PARA PROD  -- 

SELECT TOTAL_VALBRUT, Z8_PERC, Z8_CODVEN, F4_DUPLIC 
	FROM ( 
		SELECT SUM(SD2.D2_VALBRUT) AS TOTAL_VALBRUT, 
		SZ8.Z8_PERC, 
		SZ8.Z8_CINI, 
		SZ8.Z8_CFIM, 
		SZ8.Z8_CODVEN, 
		SF4.F4_DUPLIC 
			FROM SZ9100 SZ9 
				INNER JOIN SF2100 SF2 ON SF2.F2_FILIAL = '0201'
										AND SZ9.D_E_L_E_T_ = SF2.D_E_L_E_T_
										and (SZ9.Z9_CODVEN = SF2.F2_VEND1
										or SZ9.Z9_CODVEN = SF2.F2_VEND2 
										OR SZ9.Z9_CODVEN = SF2.F2_VEND3 
										OR SZ9.Z9_CODVEN = SF2.F2_VEND4 
										OR SZ9.Z9_CODVEN = SF2.F2_VEND5 )
										AND SF2.F2_EMISSAO BETWEEN '20200101' AND   '20250101' 
				INNER JOIN SZ8100 SZ8 ON SZ9.Z9_CODVEN = SZ8.Z8_CODVEN 
										AND SZ8.Z8_FILIAL = SZ9.Z9_FILIAL
										AND SZ9.D_E_L_E_T_ = SZ8.D_E_L_E_T_ 
										AND SZ8.Z8_CODVEN = SZ9.Z9_CODVEN
				INNER JOIN SD2100 SD2 ON SD2.D2_FILIAL = SF2.F2_FILIAL
										AND SD2.D2_DOC = SF2.F2_DOC 
										AND SD2.D2_SERIE = SF2.F2_SERIE 
										AND SD2.D2_CLIENTE = SF2.F2_CLIENTE 
										AND SD2.D2_LOJA = SF2.F2_LOJA 
										AND SD2.D_E_L_E_T_ = SF2.D_E_L_E_T_ 
				INNER JOIN SF4100 SF4 ON SD2.D2_TES = SF4.F4_CODIGO 
										AND SD2.D_E_L_E_T_ = SF4.D_E_L_E_T_ 
										AND SF4.F4_DUPLIC = 'S' 
										AND SF4.F4_FILIAL = '02' 
						
					WHERE SZ9.D_E_L_E_T_ = ' ' 
					and SZ9.Z9_CODVEN between '000001' and '000001'
					AND SZ9.Z9_FILIAL = '02' 
			GROUP BY
			SZ8.Z8_PERC, 
			SZ8.Z8_CINI, 
			SZ8.Z8_CFIM, 
			SZ8.Z8_CODVEN, 
			SF4.F4_DUPLIC 
			)
				AS Subquery
		WHERE TOTAL_VALBRUT BETWEEN Z8_CINI AND Z8_CFIM















































